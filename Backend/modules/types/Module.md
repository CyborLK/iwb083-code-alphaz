# Ballerina HTTP and User Management Utility

This Ballerina module includes several functions and types for managing WebSocket connections, user data, message states, and system interactions. The functionality also extends to generating random IDs, handling timestamps, and fetching profile pictures from an external service.

## Key Components

### 1. **RequestRecord Type**
   - The `RequestRecord` type represents a record containing connection metadata, such as the connection ID, type (client or WebSocket), and authorization token.
   - It automatically includes a timestamp using the `time:utcNow()` function to record when the request was made.

### 2. **User Type**
   - This record defines a user object with various attributes such as:
     - `id`: A randomly generated string ID (20 characters).
     - `tagname`: A random 10-character string used as a user tag.
     - `fullname`, `email`, `password`: Core user data.
     - Optional fields like `avatar`, `websocketId`, and `jwtoken` for profile images, WebSocket connections, and JWT tokens respectively.
   - The `getRandomId()` function generates unique IDs using the `random:createIntInRange()` function.

### 3. **Message Type**
   - Defines a message structure with:
     - `id`: Unique identifier for the message.
     - `rxId`: Receiver ID to determine the target user.
     - `message`: The actual message content.
     - `timestamp`: A timestamp when the message is created, which is generated by the `getThisTime()` function.

### 4. **State Management (getStateCode)**
   - The `getStateCode()` function maps message state codes (e.g., 601 for "received", 602 for "stored") to human-readable strings.
   - This supports several states such as:
     - Received, stored, sent, delivered, seen, deleted, failed.
     - Additional codes for system actions like ping-pong, online, and email events.
   - Any unknown or unmatched states default to "unknown".

### 5. **MessageState Type**
   - Represents the state of a message, including:
     - `messageId`: The ID of the message.
     - `state`: The state code of the message (601-607).
     - `stateText`: A textual representation of the message state, such as "received", "sent", etc.
     - `stateDescription`: An optional description to provide more context about the message state.

### 6. **SystemMessage Type**
   - The `SystemMessage` record defines system-level messages such as ping-pong responses, online status, email checks, or message notifications.
   - Each system message includes:
     - A code (701-705) that categorizes the system message.
     - A description (`message`) of the action or event.
     - An optional value field to include extra data, which can be of any type.

### 7. **Helper Functions**
   - `getRandomId()`: This function generates a random string of a given length using alphanumeric characters. It is used to create unique IDs for users and messages.
   - `getThisTime()`: Returns the current timestamp as an integer, calculated from the UTC time. This ensures consistent time tracking for message creation and event logging.
   - `getProfilePicture()`: This function fetches a user's profile picture from an external API based on their username. If the fetch is successful, the URL of the avatar is returned; otherwise, it returns null.

## Conclusion

This module handles key functionality for managing user data, message states, and WebSocket connections within a Ballerina-based application. It includes utility functions for generating random IDs, fetching profile pictures, and tracking message states, making it well-suited for real-time applications with user authentication and messaging.
